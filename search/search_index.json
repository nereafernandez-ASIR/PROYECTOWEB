{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Introducci\u00f3n a LayerHub","text":"<p>LayerHub es una plataforma integral dise\u00f1ada para la gesti\u00f3n de recursos en el \u00e1mbito de la impresi\u00f3n 3D. El sistema integra un entorno de comercio electr\u00f3nico para la adquisici\u00f3n de hardware y materiales con una secci\u00f3n comunitaria para el intercambio de modelos STL y contenido educativo.</p>"},{"location":"#objetivos-del-proyecto","title":"Objetivos del Proyecto","text":"<p>El desarrollo ha sido orientado hacia la creaci\u00f3n de una infraestructura robusta y escalable que cumpla con los siguientes est\u00e1ndares:</p> <ul> <li>Arquitectura Modular: Separaci\u00f3n clara entre la l\u00f3gica del backend (PHP) y la interfaz est\u00e9tica (CSS/JS).</li> <li>Gesti\u00f3n de Datos Centralizada: Uso de SQLite para una persistencia eficiente y de baja latencia.</li> <li>Seguridad Multi-capa: Implementaci\u00f3n de controles de acceso basados en roles y validaciones estrictas de servidor.</li> <li>Interactividad Social: Sistemas de seguimiento, valoraciones y feedback din\u00e1mico.</li> </ul>"},{"location":"#stack-tecnologico","title":"Stack Tecnol\u00f3gico","text":"<p>El portal ha sido desarrollado utilizando las siguientes tecnolog\u00edas de grado industrial:</p> Capa Tecnolog\u00eda Descripci\u00f3n Backend PHP 8.1+ L\u00f3gica de servidor y controladores de datos. Base de Datos SQLite 3 Base de datos relacional integrada. Frontend Vanilla JS / CSS3 Interfaz de usuario sin dependencias pesadas. Seguridad BCRYPT / PDO Encriptaci\u00f3n de credenciales y prevenci\u00f3n de SQLi."},{"location":"#estructura-de-la-documentacion","title":"Estructura de la Documentaci\u00f3n","text":"<p>Este portal t\u00e9cnico se divide en las siguientes secciones para facilitar su consulta:</p> <ol> <li>Arquitectura del Sistema: Descripci\u00f3n de la organizaci\u00f3n de archivos y flujo de datos.</li> <li>Modelo de Datos: Esquema relacional, tablas y l\u00f3gica de base de datos.</li> <li>L\u00f3gica Especializada: An\u00e1lisis de c\u00f3digo de funcionalidades cr\u00edticas (Carrito, Subidas).</li> <li>Seguridad y Roles: Protocolos de autenticaci\u00f3n y niveles de acceso.</li> <li>Instalaci\u00f3n: Procedimientos de despliegue y mantenimiento.</li> </ol>"},{"location":"architecture/","title":"Arquitectura del Sistema","text":"<p>LayerHub utiliza una estructura modular que separa la l\u00f3gica del negocio de la presentaci\u00f3n visual.</p>"},{"location":"architecture/#estructura-de-directorios","title":"\ud83d\udcc2 Estructura de Directorios","text":"<pre><code>/\n\u251c\u2500\u2500 docs/               # Archivos fuente de esta documentaci\u00f3n (Markdown)\n\u251c\u2500\u2500 php/                # L\u00f3gica de Negocio (Backend)\n\u2502   \u251c\u2500\u2500 auth/           # Login, Registro y Logout\n\u2502   \u251c\u2500\u2500 community/      # Procesadores de subidas, ratings y follows\n\u2502   \u2514\u2500\u2500 includes/       # Configuraci\u00f3n global y gesti\u00f3n de sesiones\n\u251c\u2500\u2500 public/             # Archivos P\u00fablicos (Frontend)\n\u2502   \u251c\u2500\u2500 admin/          # Panel de Gesti\u00f3n Administrativo\n\u2502   \u251c\u2500\u2500 css/            # Estilos globales y espec\u00edficos\n\u2502   \u251c\u2500\u2500 images/         # Recursos gr\u00e1ficos y placeholders\n\u2502   \u251c\u2500\u2500 js/             # Scripts de interactividad\n\u2502   \u2514\u2500\u2500 uploads/        # Archivos subidos por usuarios (Modelos/Im\u00e1genes)\n\u251c\u2500\u2500 db/                 # Almacenamiento de la Base de Datos SQLite\n\u2514\u2500\u2500 mkdocs.yml          # Configuraci\u00f3n de este portal\n</code></pre>"},{"location":"architecture/#flujo-de-una-peticion-request","title":"\ud83d\udd04 Flujo de una Petici\u00f3n (Request)","text":"<p>Cuando un usuario interact\u00faa con la p\u00e1gina, el flujo sigue este patr\u00f3n:</p> <ol> <li>Interfaz: El usuario hace clic en una acci\u00f3n (ej: Comprar) en un archivo en <code>public/</code>.</li> <li>Controlador: Se env\u00eda una petici\u00f3n (GET/POST) a un archivo en <code>php/</code>.</li> <li>Seguridad: Se invoca <code>session.php</code> para verificar permisos.</li> <li>Base de Datos: El archivo PHP se comunica con <code>config.php</code> para realizar operaciones SQL.</li> <li>Respuesta: El servidor responde con una redirecci\u00f3n o un JSON (AJAX).</li> </ol>"},{"location":"architecture/#integracion-php","title":"\ud83e\udde9 Integraci\u00f3n PHP","text":"<p>Todos los archivos del sistema incluyen dos pilares fundamentales al inicio:</p> <pre><code>require_once __DIR__ . '/../php/includes/session.php'; // Gesti\u00f3n de sesiones\nrequire_once __DIR__ . '/../php/includes/config.php';  // Conexi\u00f3n y Helpers\n</code></pre> <ul> <li>session.php: Define si hay un usuario activo (<code>isLoggedIn()</code>) y sus roles.</li> <li>config.php: Centraliza la conexi\u00f3n PDO y funciones comunes como <code>sanitize()</code> y <code>redirect()</code>.</li> </ul>"},{"location":"database/","title":"Modelo de Datos y Gesti\u00f3n de Persistencia","text":"<p>El sistema utiliza SQLite 3 como motor de base de datos relacional. La gesti\u00f3n se centraliza en una arquitectura orientada a objetos a trav\u00e9s de la clase <code>Database</code>.</p>"},{"location":"database/#diagrama-de-entidad-relacion","title":"Diagrama de Entidad-Relaci\u00f3n","text":"<p>La estructura de datos garantiza la integridad mediante claves for\u00e1neas y restricciones de borrado en cascada.</p> <pre><code>erDiagram\n    USERS ||--o{ POSTS : \"gestiona\"\n    USERS ||--o{ ORDERS : \"registra\"\n    USERS ||--o{ USER_FOLLOWS : \"participa\"\n    POSTS ||--o| STL_FILES : \"vincula\"\n    USERS ||--o{ RATINGS : \"asocia\"\n    STL_FILES ||--o{ RATINGS : \"recibe\"\n    ORDERS ||--o{ ORDER_ITEMS : \"contiene\"\n    PRODUCTS ||--o{ ORDER_ITEMS : \"pertenece\"\n    PRODUCTS ||--o{ CART : \"incluye\"\n    USERS ||--o{ CART : \"posee\"</code></pre>"},{"location":"database/#implementacion-de-la-capa-de-datos","title":"Implementaci\u00f3n de la Capa de Datos","text":"<p>La conexi\u00f3n se gestiona mediante el patr\u00f3n Singleton para evitar m\u00faltiples conexiones innecesarias al archivo de base de datos.</p> <pre><code>class Database {\n    private static $instance = null;\n    private $connection;\n\n    private function __construct() {\n        try {\n            $this-&gt;connection = new PDO('sqlite:' . DB_PATH);\n            $this-&gt;connection-&gt;setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);\n            $this-&gt;connection-&gt;setAttribute(PDO::ATTR_DEFAULT_FETCH_MODE, PDO::FETCH_ASSOC);\n            $this-&gt;connection-&gt;exec('PRAGMA foreign_keys = ON');\n        } catch (PDOException $e) {\n            die(\"Error cr\u00edtico de base de datos.\");\n        }\n    }\n\n    public static function getInstance() {\n        if (self::$instance === null) {\n            self::$instance = new Database();\n        }\n        return self::$instance;\n    }\n}\n</code></pre>"},{"location":"database/#definicion-tecnica-de-tablas","title":"Definici\u00f3n T\u00e9cnica de Tablas","text":""},{"location":"database/#usuarios-users","title":"Usuarios (users)","text":"<p>Gestiona la identidad y el nivel de privilegio. El campo <code>blocked</code> act\u00faa como interruptor global de seguridad.</p>"},{"location":"database/#productos-products","title":"Productos (products)","text":"<p>Almacena el cat\u00e1logo de hardware. El sistema utiliza transacciones para asegurar que el decremento de <code>stock</code> sea at\u00f3mico durante una compra.</p>"},{"location":"database/#modelos-stl-y-comunidad","title":"Modelos STL y Comunidad","text":"<p>La relaci\u00f3n entre <code>posts</code> y <code>stl_files</code> permite una gesti\u00f3n flexible del contenido social, manteniendo la metadata separada de la ruta f\u00edsica del archivo.</p>"},{"location":"features/","title":"An\u00e1lisis de C\u00f3digo y Funcionalidades Cr\u00edticas","text":"<p>En esta secci\u00f3n se detalla la implementaci\u00f3n t\u00e9cnica de los procesos m\u00e1s complejos del backend de LayerHub.</p>"},{"location":"features/#sistema-de-gestion-de-carrito","title":"Sistema de Gesti\u00f3n de Carrito","text":"<p>La l\u00f3gica del carrito se sincroniza directamente con la base de datos para garantizar la disponibilidad de los productos y la persistencia de la sesi\u00f3n.</p>"},{"location":"features/#recuperacion-de-productos","title":"Recuperaci\u00f3n de Productos","text":"<p>A continuaci\u00f3n se muestra el c\u00f3digo utilizado para obtener los elementos del carrito vinculando la informaci\u00f3n de stock y precio:</p> <pre><code>$stmt = $db-&gt;prepare(\"\n    SELECT c.*, p.title, p.price, p.image, p.stock \n    FROM cart c \n    JOIN products p ON c.product_id = p.id \n    WHERE c.user_id = ?\n    ORDER BY c.added_at DESC\n\");\n$stmt-&gt;execute([$user['id']]);\n$cartItems = $stmt-&gt;fetchAll();\n</code></pre>"},{"location":"features/#procesamiento-de-subida-de-archivos-stl","title":"Procesamiento de Subida de Archivos STL","text":"<p>La subida de archivos 3D requiere validaciones estrictas de tama\u00f1o, extensi\u00f3n y tipo MIME para prevenir la ejecuci\u00f3n de c\u00f3digo malicioso.</p>"},{"location":"features/#logica-de-validacion-de-seguridad","title":"L\u00f3gica de Validaci\u00f3n de Seguridad","text":"<p>El controlador realiza una comprobaci\u00f3n triple (Extensi\u00f3n, Tama\u00f1o y MIME real v\u00eda <code>finfo</code>):</p> <pre><code>$finfo = finfo_open(FILEINFO_MIME_TYPE);\n$mime = finfo_file($finfo, $file['tmp_name']);\nfinfo_close($finfo);\n\nif (!in_array($mime, $allowedMime)) {\n    if ($mime !== 'application/octet-stream' &amp;&amp; $mime !== 'text/plain') {\n        setFlash('Contenido no v\u00e1lido', 'error');\n        redirect('/public/comunidad.php');\n    }\n}\n</code></pre>"},{"location":"features/#gestion-de-contenido-multimedia-tutoriales","title":"Gesti\u00f3n de Contenido Multimedia (Tutoriales)","text":"<p>El sistema de tutoriales admite un flujo h\u00edbrido: carga directa de video (.mp4) o vinculaci\u00f3n de enlaces externos (YouTube).</p>"},{"location":"features/#control-de-flujo-de-video","title":"Control de Flujo de Video","text":"<p>El c\u00f3digo prioriza la subida f\u00edsica del archivo si este existe y cumple los requisitos t\u00e9cnicos:</p> <pre><code>if (isset($_FILES['video_file']) &amp;&amp; $_FILES['video_file']['error'] === UPLOAD_ERR_OK) {\n    // Proceso de validaci\u00f3n de MP4 y almacenamiento f\u00edsico\n    $fileName = uniqid('video_') . '.mp4';\n    $uploadPath = __DIR__ . '/../../uploads/users/videos/' . $fileName;\n    move_uploaded_file($file['tmp_name'], $uploadPath);\n} else if (!empty($videoUrl)) {\n    // Almacenamiento de referencia externa a YouTube\n    $finalVideoSource = $videoUrl;\n}\n</code></pre>"},{"location":"features/#moderacion-de-contenido","title":"Moderaci\u00f3n de Contenido","text":"<p>Toda contribuci\u00f3n comunitaria queda marcada con el estado <code>status = 'pending'</code>. Este mecanismo asegura que ning\u00fan contenido sea p\u00fablico sin la revisi\u00f3n manual del administrador, cuya l\u00f3gica se encuentra centralizada en los controladores de administraci\u00f3n de la plataforma.</p>"},{"location":"installation/","title":"Gu\u00eda de Instalaci\u00f3n y Mantenimiento del Sistema","text":"<p>Este documento describe el procedimiento est\u00e1ndar para el despliegue de LayerHub y su portal de documentaci\u00f3n t\u00e9cnica.</p>"},{"location":"installation/#requisitos-de-entorno","title":"Requisitos de Entorno","text":"<ul> <li>Servidor HTTP con soporte para PHP 8.1.</li> <li>Extensiones de PHP habilitadas: <code>pdo_sqlite</code>, <code>fileinfo</code>.</li> <li>Permisos de escritura en los directorios <code>db/</code> y <code>public/uploads/</code>.</li> </ul>"},{"location":"installation/#despliegue-de-la-plataforma","title":"Despliegue de la Plataforma","text":"<ol> <li>Configure la variable <code>BASE_URL</code> en el archivo <code>php/includes/config.php</code> seg\u00fan su entorno de red.</li> <li>Aseg\u00farese de que el archivo <code>db/layerhub.sqlite</code> tenga permisos de usuario adecuados para permitir la lectura y escritura por parte de Apache/Nginx.</li> </ol>"},{"location":"installation/#gestion-de-la-documentacion-mkdocs","title":"Gesti\u00f3n de la Documentaci\u00f3n (MkDocs)","text":"<p>La documentaci\u00f3n se genera de forma est\u00e1tica, lo que permite un hosting \u00e1gil en servicios como GitHub Pages.</p>"},{"location":"installation/#comando-de-previsualizacion","title":"Comando de Previsualizaci\u00f3n","text":"<p>Para observar los cambios en tiempo real durante la edici\u00f3n de los archivos Markdown: <pre><code>mkdocs serve\n</code></pre></p>"},{"location":"installation/#comando-de-publicacion-en-github","title":"Comando de Publicaci\u00f3n en GitHub","text":"<p>Para actualizar la versi\u00f3n p\u00fablica alojada en el repositorio de GitHub: <pre><code>mkdocs gh-deploy\n</code></pre></p> <p>Este comando automatiza la compilaci\u00f3n del sitio y su transferencia a la rama <code>gh-pages</code> del repositorio configurado.</p>"},{"location":"security/","title":"Seguridad y Gobernanza de Datos","text":"<p>El framework de seguridad de LayerHub se basa en un modelo defensivo de m\u00faltiples capas que garantiza la integridad de la plataforma.</p>"},{"location":"security/#control-de-acceso-basado-en-roles-rbac","title":"Control de Acceso Basado en Roles (RBAC)","text":"<p>La plataforma distingue entre tres niveles de privilegio mediante la funci\u00f3n <code>requireRole</code>, la cual valida la sesi\u00f3n activa antes de procesar cualquier componente de vista.</p>"},{"location":"security/#implementacion-del-middleware-de-roles","title":"Implementaci\u00f3n del Middleware de Roles","text":"<p>El siguiente fragmento demuestra c\u00f3mo el sistema bloquea el acceso no autorizado a nivel de servidor:</p> <pre><code>function isAdmin() {\n    return isLoggedIn() &amp;&amp; isset($_SESSION['role']) &amp;&amp; $_SESSION['role'] === 'admin';\n}\n\nfunction requireAdmin() {\n    if (!isAdmin()) {\n        http_response_code(403);\n        die('Acceso denegado. Permisos de administrador requeridos.');\n    }\n}\n</code></pre>"},{"location":"security/#prevencion-contra-ataques-de-sesion","title":"Prevenci\u00f3n contra Ataques de Sesi\u00f3n","text":"<p>Para mitigar riesgos de secuestro de sesi\u00f3n (Session Hijacking), el sistema implementa una verificaci\u00f3n de la huella digital del navegador.</p> <pre><code>function validateSession() {\n    if (isLoggedIn()) {\n        $currentUserAgent = $_SERVER['HTTP_USER_AGENT'] ?? '';\n        if (!isset($_SESSION['user_agent'])) {\n            $_SESSION['user_agent'] = $currentUserAgent;\n        } else if ($_SESSION['user_agent'] !== $currentUserAgent) {\n            destroySession();\n            redirect('/public/index.php');\n        }\n    }\n}\n</code></pre>"},{"location":"security/#integridad-de-los-datos-y-almacenamiento","title":"Integridad de los Datos y Almacenamiento","text":""},{"location":"security/#sanitizacion-de-entradas","title":"Sanitizaci\u00f3n de Entradas","text":"<p>Todas las variables provenientes de <code>$_GET</code> o <code>$_POST</code> son tratadas antes de ser concatenadas o utilizadas en la l\u00f3gica de negocio, eliminando etiquetas HTML potencialmente maliciosas.</p> <pre><code>function sanitize($data) {\n    return htmlspecialchars(strip_tags(trim($data)), ENT_QUOTES, 'UTF-8');\n}\n</code></pre>"},{"location":"security/#hash-de-credenciales","title":"Hash de Credenciales","text":"<p>El sistema utiliza el est\u00e1ndar industrial BCRYPT para el almacenamiento de contrase\u00f1as, asegurando que incluso en caso de una brecha en la base de datos, las credenciales no sean legibles.</p>"}]}